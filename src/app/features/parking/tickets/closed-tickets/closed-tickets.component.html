<h3 class="mb-3">ðŸ§¾ Closed Tickets</h3>

<div *ngIf="tickets?.length; else noClosed">
  <div class="table-responsive">
    <table class="table table-striped table-bordered align-middle">
      <thead class="table-light">
        <tr>
          <th>Ticket ID</th>
          <th>Vehicle</th>
          <th>Type</th>
          <th>Floor</th>
          <th>Spot</th>
          <th>Parked At</th>
          <th>Unparked At</th>
          <th>Duration</th>
          <th>Fee</th>
          <th>Status</th>
          <th>Invoice</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let t of tickets">
          <td>{{ t.ticketId }}</td>
          <td>{{ t.vehicleNumber }}</td>
          <td>{{ t.allowedType }}</td>
          <td>{{ t.floorId }}</td>
          <td>{{ t.spotId }}</td>
          <td>{{ t.parkedAt | date:'short' }}</td>
          <td>{{ t.unparkedAt | date:'short' }}</td>
          <td>{{ duration(t.parkedAt, t.unparkedAt) }}</td>

          <!-- Fix for ?? operator -->
          <td>â‚¹{{ t.fee !== undefined && t.fee !== null ? t.fee : '-' }}</td>

          <!-- Payment status badge -->
          <td>
            <span class="badge rounded-pill" [ngClass]="{
                'bg-success': t.fee && t.fee > 0,
                'bg-secondary': !t.fee
              }">
              {{ t.fee && t.fee > 0 ? 'PAID' : 'UNPAID' }}
            </span>
          </td>

          <!-- View invoice -->
          <td>
            <button *ngIf="hasInvoice(t)" class="btn btn-sm btn-outline-primary" (click)="openInvoice(t)">
              <i class="bi bi-receipt me-1"></i> View
            </button>
          </td>
        </tr>
      </tbody>
    </table>
  </div>
</div>

<ng-template #noClosed>
  <div class="alert alert-secondary">No closed tickets yet.</div>
</ng-template>